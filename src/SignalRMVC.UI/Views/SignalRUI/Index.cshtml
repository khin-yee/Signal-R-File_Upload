@{
    ViewData["Title"] = "SignalR Real-Time Chat";
}
<form asp-action="CallApi" method="get">
    <div class="card shadow-lg rounded-4 p-4 mx-auto my-4" style="max-width: 700px;">
        <h4 class="text-center text-primary fw-bold mb-2 pt-2">
            <i class="bi bi-wifi"></i> SignalR Real-Time Chat
        </h4>
        <p class="text-center text-muted mb-4 fs-6">Send and receive live messages in real time</p>

        <div id="chatHistory" class="p-3 mb-4 bg-white rounded-3 border overflow-auto" style="max-height: 320px; box-shadow: inset 0 0 5px #ccc;">
            <p class="text-muted mb-3 small">
                <i class="bi bi-clock-history me-2"></i>Chat History
            </p>
            <div id="messagesList" class="d-flex flex-column gap-2"></div>
        </div>

        <div class="input-group mb-3" style="font-size: 0.9rem;">
            <input id="messageInput"
                   type="text"
                   name="message"
                   class="form-control rounded-start"
                   placeholder="Type your message here..."
                   aria-label="Message input"
                   autocomplete="off"
                   required
                   style="height: 38px; font-size: 0.9rem;" />
            <button id="sendBtn"
                    type="submit"
                    class="btn btn-primary rounded-end"
                    title="Send message"
                    aria-label="Send message"
                    style="height: 38px; font-size: 1rem;">
                <i class="bi bi-send-fill"></i>
            </button>
        </div>
    </div>
</form>

@section Scripts {
    <script type="module">
        import { SignalRService } from '/js/signalrService.js';         
        const signalR = new SignalRService("https://localhost:7055");
        await signalR.start();
        await signalR.joinGroup("123");

        signalR.onReceiveMessage("ReceiveMessage", async (message, userId, time) => {
            console.log(`Message from ${userId}: ${message} at ${time}`);

            const request = {
                message: message,
                userid: userId,
                time: time
            };

        });       
    </script>
}
